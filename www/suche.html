<!DOCTYPE HTML>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="generator" content="PSPad editor, www.pspad.com">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>DKM Stellenmarkt mobile Version</title>
  <link rel="stylesheet" href="css/jquery.mobile-1.3.0.css">
  <link rel="stylesheet" href="css/scrollview.css">
  <link rel="stylesheet" href="css/themes/dkm.css">
  <script src="js/jquery-1.9.1.js"></script>
  <script src="cordova.js"></script>
  <script src="js/jquery.mobile-1.3.0.js"></script>
  <script src="js/scrollview.js"></script>

  <script>
       $(document).bind("mobileinit", function(){
          $.mobile.allowCrossDomainPages = true;
          $.mobile.ajaxEnabled = false;
          $.mobile.page.prototype.options.domCache = false;
       });
       
       var dkmRestAPIURL = null;
       
       dkmRestAPIURL = 'http://rest.dkm-service.de/api';
       
       var searchresult = {};
       
       $(document).ready(function() {  
          
        var arrBranchen = [];
    	  var arrStellentypen = [];
    	  var arrBerufsfelder = [];
        
        var userCookie = "richter";
       
        $("#searchprofileerrormsg").hide();
    	  $("#popupSearchProfileSubmit").hide();
    	  $("#sendfavoriteserrormsg").hide();
    	  $("#favoriteserrormsgdelete").hide();
    	  $("#popupSendFavoritesSubmit").hide();
    	  $("#popupFavoritesSubmitDelete").hide();
    	  $("#locationError").hide();
    	  
          $.getJSON(dkmRestAPIURL+"/jobs/berufsfelder/json", function(data){
    		  $.each(data, function (index, value) {
    	      	    arrBerufsfelder.push(value["id"]);
    		  });
    	  });
          
    	  $.getJSON(dkmRestAPIURL+"/jobs/branchen/json", function(data){
    		  $.each(data, function (index, value) {
    	      	    arrBranchen.push(value["id"]);
    		  });
    	  });
    	  
    	  $.getJSON(dkmRestAPIURL+"/jobs/typen/json", function(data){
    		  $.each(data, function (index, value) {
    	      	    arrStellentypen.push(value["id"]);
    		  });
    	  });
          
          $.get(dkmRestAPIURL+"/jobs/branchen/options", function(data){  
        	  if($("#select-branche").length > 0) {
        		$("#select-branche").selectmenu();
          		$("#select-branche").html("<option>Bitte w&auml;hlen Sie:</option>"+data).selectmenu("refresh");
        	    $("#select-branche-button").click(function(){
      		  	  setTimeout(function(){
      		  		$("#select-branche-dialog").find('.ui-icon').removeClass('ui-icon-delete').addClass('ui-icon-check');
      		  		btnLeft = $("#select-branche-dialog").find('.ui-btn-left');
      		  		btnLeft.attr('data-iconpos','left');
      		  		btnLeft.attr('data-mini','true');
      		  		btnLeft.removeClass('ui-btn-icon-notext').addClass('ui-btn-icon-left');
      		  		btnLeft.find('.ui-btn-text').text("Fertig");      		  	
      		  	  },10);
                });
        	  }
          });
          
          $.get(dkmRestAPIURL+"/jobs/typen/options", function(data){  
        	  if($("#select-stellentyp").length > 0) {
        		$("#select-stellentyp").selectmenu();
        		$("#select-stellentyp").html("<option>Bitte w&auml;hlen Sie:</option>"+data).selectmenu("refresh");  
        	  	$("#select-stellentyp-button").click(function(){
        			setTimeout(function(){
        				$("#select-stellentyp-dialog").find('.ui-icon-delete').removeClass('ui-icon-delete').addClass('ui-icon-check');
        		  		btnLeft = $("#select-stellentyp-dialog").find('.ui-btn-left');
        		  		btnLeft.attr('data-iconpos','left');
        		  		btnLeft.attr('data-mini','true');
        		  		btnLeft.removeClass('ui-btn-icon-notext').addClass('ui-btn-icon-left');
        		  		btnLeft.find('.ui-btn-text').text("Fertig");      		  	
        		  	},10);
              	});
        	  }
          });
          
          
          $.get(dkmRestAPIURL+"/jobs/berufsfelder/options", function(data){  
        	  if($("#select-berufsfeld").length > 0) {
        		$("#select-berufsfeld").selectmenu();
        		$("#select-berufsfeld").html("<option>Bitte w&auml;hlen Sie:</option>"+data).selectmenu("refresh");  
        	    $("#select-berufsfeld-button").click(function(){
        		  setTimeout(function(){
        		    $("#select-berufsfeld-dialog").find('.ui-icon').removeClass('ui-icon-delete').addClass('ui-icon-check');
      		  		btnLeft = $("#select-berufsfeld-dialog").find('.ui-btn-left');
      		  		btnLeft.attr('data-iconpos','left');
      		  		btnLeft.attr('data-mini','true');
      		  		btnLeft.removeClass('ui-btn-icon-notext').addClass('ui-btn-icon-left');
      		  		btnLeft.find('.ui-btn-text').text("Fertig");      		  	
      		  	  },10);
                });
        	  }
          });
              
          function setIFrame(id,url,pf,fav) {
        	  winwidthpopup = $(window).width()*0.8;
        	  winheightpopup = $(window).height()*0.8;
        	  winwidthiframe = winwidthpopup;
        	  winheightiframe = winheightpopup;
        	  
        	  if(fav == "true") {
        		  favButton = '<a href="#" id="favlink'+pf+id+'" data-role="button" data-theme="a" data-icon="fav-active" data-mini="true" data-iconpos="left" class="ui-btn-left">gemerkt</a>';
        	  } else {
        		  favButton = '<a href="#" id="favlink'+pf+id+'" data-role="button" data-theme="a" data-icon="fav-inactive" data-mini="true" data-iconpos="left" class="ui-btn-left">merken</a>';
        	  }
        	  
            iframeprestring = favButton+'<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
            
            // alert(winheightiframe);
              
            if(device.platform == "iOS") {
              iframestring = '<div style="width: '+winwidthiframe+'px; height: '+winheightiframe+'px; overflow: scroll !important;-webkit-overflow-scrolling:touch !important;"><object class="object" data="'+url+'" style="width: 1000px; height: 1000px; align: center; overflow: scroll;"></object></div>';
            } else {
              //iframestring = '<iframe src="'+url+'" seamless frameborder="0" width="'+winwidthiframe+'" height="'+winheightiframe+'" style="align: center;"></iframe>';
              iframestring = '<object class="object" data="'+url+'" style="width: '+winwidthiframe+'px; height: '+winheightiframe+'px; align: center;"></object>';
            }
            
        	  $("#jobPopup"+pf+id).html(iframeprestring+iframestring);
        	  $("#jobPopup"+pf+id).trigger("create");

        	  $("#favlink"+pf+id).on("click", function(event) {
       			 if($(this).attr("data-icon") == "fav-active") {
       				 $.get(dkmRestAPIURL+"/jobs/favorite/delete/"+userCookie+"__"+id, function(data){  
       				 });
       			     
   					 $(this).attr("data-icon","fav-inactive");
       				 $(this).find('.ui-icon').removeClass('ui-icon-fav-active').addClass('ui-icon-fav-inactive');
       				 $(this).find('.ui-btn-text').text("merken");
       	 		 } else {
       	 			$.get(dkmRestAPIURL+"/jobs/favorite/add/"+userCookie+"__"+id, function(data){  
       	 			 	
   					});
       	 		    
					$(this).attr("data-icon","fav-active");
       				$(this).find('.ui-icon').removeClass('ui-icon-fav-inactive').addClass('ui-icon-fav-active');
       				$(this).find('.ui-btn-text').text("gemerkt");
       	 		 }
       		  });

        	  $("#jobPopup"+pf+id).width(winwidthpopup);
    		  $("#jobPopup"+pf+id).height(winheightpopup);
    		  
          }
          
          function validateEmail(email) {
              var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        	  return regex.test(email);
        	  
          }
          
          function registerSearchProfile() {
        	  $.get(dkmRestAPIURL+"/jobs/profile/register/"+createSearchProfileString(), function(data){  
        	  	if(data == "OK") {
        	  		$("#popupSearchProfileDialog").hide();
              	    $("#popupSearchProfileSubmit").show();
        	  	} else {
        	  		$("#searchprofileerrormsg").text(data);
        	  		$("#searchprofileerrormsg").show();
        	  	}
        	  });  
          }
          
          function showMoreResults(startindex) {
              $("#searchresultlistul li").last().remove();
              var htmlstring = '';
              $.mobile.showPageLoadingMsg();
               	 
              
              $.each(searchresult, function (index, value) {
            	if(index >= startindex && index < startindex+20) {
            		if(value["fav"] == "true") {
            			iconFav = "fav-active";
           				iconFavText = "gemerkt"
            		} else {
            			iconFav = "fav-inactive";
            			iconFavText = "merken"
            		}

         			if(value["jobtype"] == "text") {
               			htmlstring += '<li><a href="#jobPopupsr'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
               			htmlstring += '<div data-role="popup" id="jobPopupsr'+value["id"]+'" data-scroll="x" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window">';
               			htmlstring += '</div>';
               		} else if (value["jobtype"] == "bildpdf" || (value["jobtype"] == "url" && value["url"].indexOf(".pdf") >= 0)) {
               			htmlstring += '<li><a href="#jobPopupsr'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
               			htmlstring += '<div data-role="popup" id="jobPopupsr'+value["id"]+'" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window"><a href="#" id="favlinksr'+value["id"]+'" data-role="button" data-theme="a" data-icon="'+iconFav+'" data-iconpos="left" data-mini="true" class="ui-btn-left">'+iconFavText+'</a><a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
               			htmlstring += '<p style="text-align: center;">';
               			htmlstring += '<a data-theme="a" data-inline="true" data-icon="arrow-d" data-role="button" id="pdflinksr'+value["id"]+'" href="'+value["url"]+'">PDF-Download</a>';
            		    htmlstring += '</p>';
            		    // '</object>';
            		    htmlstring += '</div>';
               		} else {
               			htmlstring += '<li><a href="#jobPopupsr'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
               			htmlstring += '<div data-role="popup" id="jobPopupsr'+value["id"]+'" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window"><a href="#" id="favlinksr'+value["id"]+'" data-role="button" data-theme="a" data-icon="'+iconFav+'" data-iconpos="left" data-mini="true" class="ui-btn-left">'+iconFavText+'</a><a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
               			htmlstring += '</div>';
               		}
            	  }
              });
              
              $("#searchresultlistul").append(htmlstring);
              if(startindex+20 <= searchresult.length)
                  $("#searchresultlistul").append('<li><a href="#" id="mehrlink"><h3>Mehr ...</h3></a></li>');
              
              $("#searchresultlistul").listview("refresh");
              $('#searchresultlist').trigger("create");
              
              $("a[id*=pdflink]").on( "click", function( event ) {
              	  event.preventDefault();
              	  var targetlink = $(this).attr("href");
              	  var ref = window.open(targetlink,"_system","location=yes");
                });
              
          		if(startindex+20 <= searchresult.length) {
                $('#mehrlink').on("click", function(event) {
                  event.preventDefault();
                  showMoreResults(startindex+20);
                });
              }
            	
            	$.each(searchresult, function (index, value) {
         			    if(index >= startindex && index < startindex+20) {
            	 		if(value["jobtype"] == "text") {
           				$( "#jobPopupsr"+value["id"] ).on({
           			        popupbeforeposition: function() {
           			          setIFrame(value["id"],"http://media.dkm-service.de/stellenmarkt/index.php?module=showjob&ID="+value["id"]+"&location=mobile","sr",value["fav"]);
           			        },
           			        popupafterclose: function() {}
           			    });
           				
                 	} else if (value["jobtype"] == "url" && value["url"].indexOf(".pdf") < 0) {
                 			$( "#jobPopupsr"+value["id"] ).on({
           			        popupbeforeposition: function() {
           			        	setIFrame(value["id"],value["url"],"sr",value["fav"]);
           			        },
           			        popupafterclose: function() {}
           			    });
                 	} else if (value["jobtype"] == "bildpdf" || (value["jobtype"] == "url" && value["url"].indexOf(".pdf") >= 0)) {
           			  $("#favlinksr"+value["id"]).on("click", function(event) {
               			 if($(this).attr("data-icon") == "fav-active") {
               				 $.get(dkmRestAPIURL+"/jobs/favorite/delete/"+userCookie+"__"+value["id"], function(data){  
               				 });
               				 
               				
               				 $(this).attr("data-icon","fav-inactive");
               				 $(this).find('.ui-icon').removeClass('ui-icon-fav-active').addClass('ui-icon-fav-inactive');
               				 $(this).find('.ui-btn-text').text("merken");
               	 		 } else {
               	 			$.get(dkmRestAPIURL+"/jobs/favorite/add/"+userCookie+"__"+value["id"], function(data){  
               	 			});
               	 		    
          				    
               				$(this).attr("data-icon","fav-active");
               				$(this).find('.ui-icon').removeClass('ui-icon-fav-inactive').addClass('ui-icon-fav-active');
               				$(this).find('.ui-btn-text').text("gemerkt");
               	 		 }
               		  });
                	}
         			  }
                  
      		    });
              $.mobile.hidePageLoadingMsg();
          }
          
          function showResult(sortorder) {
              var htmlstring = "<ul id='searchresultlistul' data-role='listview'>";
              $.mobile.showPageLoadingMsg();              
              
              console.log("Query: "+dkmRestAPIURL+"/jobs/list/"+device.uuid+"___"+createQueryString(sortorder));
              
        	    $.getJSON(dkmRestAPIURL+"/jobs/list/"+device.uuid+"___"+createQueryString(sortorder), function(data){
           		   searchresult = data;
              
            	$.each(searchresult, function (index, value) {
            	
            		if(value["fav"] == "true") {
            			iconFav = "fav-active";
           				iconFavText = "gemerkt"
            		} else {
            			iconFav = "fav-inactive";
            			iconFavText = "merken"
            		}

         			if(value["jobtype"] == "text") {
               			htmlstring += '<li><a href="#jobPopupsr'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
               			htmlstring += '<div data-role="popup" id="jobPopupsr'+value["id"]+'" data-scroll="x" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window">';
               			htmlstring += '</div>';
               		} else if (value["jobtype"] == "bildpdf" || (value["jobtype"] == "url" && value["url"].indexOf(".pdf") >= 0)) {
               			htmlstring += '<li><a href="#jobPopupsr'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
               			htmlstring += '<div data-role="popup" id="jobPopupsr'+value["id"]+'" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window"><a href="#" id="favlinksr'+value["id"]+'" data-role="button" data-theme="a" data-icon="'+iconFav+'" data-iconpos="left" data-mini="true" class="ui-btn-left">'+iconFavText+'</a><a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
               			htmlstring += '<p style="text-align: center;">';
               			htmlstring += '<a data-theme="a" data-inline="true" data-icon="arrow-d" data-role="button" id="pdflinksr'+value["id"]+'" href="'+value["url"]+'">PDF-Download</a>';
            		    htmlstring += '</p>';
            		    // '</object>';
            		    htmlstring += '</div>';
               		} else {
               			htmlstring += '<li><a href="#jobPopupsr'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
               			htmlstring += '<div data-role="popup" id="jobPopupsr'+value["id"]+'" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window"><a href="#" id="favlinksr'+value["id"]+'" data-role="button" data-theme="a" data-icon="'+iconFav+'" data-iconpos="left" data-mini="true" class="ui-btn-left">'+iconFavText+'</a><a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
               			htmlstring += '</div>';
               		}
            	
               if (index == 19) { 
                 htmlstring += '<li><a href="#" id="mehrlink"><h3>Mehr ...</h3></a></li>';
                 return false; 
               }
              
              });
            	
              $('#searchresultlist').html(htmlstring+"</ul>").trigger("create");
          	  
              $.mobile.hidePageLoadingMsg();
                
            	$("a[id*=pdflink]").on( "click", function( event ) {
              	  event.preventDefault();
              	  var targetlink = $(this).attr("href");
              	  var ref = window.open(targetlink,"_system","location=yes");
                });
              
          		$('#mehrlink').on("click", function(event) {
                  event.preventDefault();
                  showMoreResults(20);
              });
            	
            	$.each(searchresult, function (index, value) {
         			
               		if(value["jobtype"] == "text") {
           				$( "#jobPopupsr"+value["id"] ).on({
           			        popupbeforeposition: function() {
           			          setIFrame(value["id"],"http://media.dkm-service.de/stellenmarkt/index.php?module=showjob&ID="+value["id"]+"&location=mobile","sr",value["fav"]);
           			        },
           			        popupafterclose: function() {}
           			    });
           				
                 	} else if (value["jobtype"] == "url" && value["url"].indexOf(".pdf") < 0) {
                 			$( "#jobPopupsr"+value["id"] ).on({
           			        popupbeforeposition: function() {
           			        	setIFrame(value["id"],value["url"],"sr",value["fav"]);
           			        },
           			        popupafterclose: function() {}
           			    });
                 	} else if (value["jobtype"] == "bildpdf" || (value["jobtype"] == "url" && value["url"].indexOf(".pdf") >= 0)) {
           			  $("#favlinksr"+value["id"]).on("click", function(event) {
               			 if($(this).attr("data-icon") == "fav-active") {
               				 $.get(dkmRestAPIURL+"/jobs/favorite/delete/"+userCookie+"__"+value["id"], function(data){  
               				 });
               				 
               				
               				 $(this).attr("data-icon","fav-inactive");
               				 $(this).find('.ui-icon').removeClass('ui-icon-fav-active').addClass('ui-icon-fav-inactive');
               				 $(this).find('.ui-btn-text').text("merken");
               	 		 } else {
               	 			$.get(dkmRestAPIURL+"/jobs/favorite/add/"+userCookie+"__"+value["id"], function(data){  
               	 			});
               	 		    
          				    
               				$(this).attr("data-icon","fav-active");
               				$(this).find('.ui-icon').removeClass('ui-icon-fav-inactive').addClass('ui-icon-fav-active');
               				$(this).find('.ui-btn-text').text("gemerkt");
               	 		 }
               		  });
                	}
         			
                  if (index == 19) { return false; };
                  
      		    });
        
            });
            
        	  $.mobile.changePage($('#searchresult'),{ transition: "slideup"});
          }
          
		  function createQueryString(sortorder) {
        	  
			  if(sortorder != "plz")
				  sortorder = "std";
			  
        	  var selBranche = $('#select-branche').val() || arrBranchen;
        	  var selTyp = $('#select-stellentyp').val() || arrStellentypen;
        	  var selBerufsfeld = $('#select-berufsfeld').val() || arrBerufsfelder;
        	  var auslandFlag = $('#ausland').val() || "0";
        	  var plz = $('#plz').val() || "00000";
        	  var fulltextString = $('#fulltextstring').val() || "@@@";
            var distance = $('#distance').val() || "000";
        	  
        	  return "0"+"_"+selBranche.join('_')+"_"+selTyp.join('_')+"_"+selBerufsfeld.join('_')+"__"+plz+"__"+auslandFlag+"__"+sortorder+"__"+fulltextString+"__"+distance;
          }
		  
		  function createSearchProfileString() {
        	  
			  var selBranche = $('#select-branche').val() || arrBranchen;
        	  var selTyp = $('#select-stellentyp').val() || arrStellentypen;
        	  var selBerufsfeld = $('#select-berufsfeld').val() || arrBerufsfelder;
        	  var auslandFlag = $('#ausland').val() || "0";
        	  var plz = $('#plz').val() || "00000";
        	  var email = $('#searchprofileemail').val();
        	  var fulltextString = $('#fulltextstring').val() || " ";
            var distance = $('#distance').val() || "000";
        		  
        	  return "0"+"_"+selBranche.join('_')+"_"+selTyp.join('_')+"_"+selBerufsfeld.join('_')+"__"+plz+"__"+auslandFlag+"__"+email+"__"+fulltextString+"__"+distance;
          }
          
          $("#submitbutton").on( "click", function( event ) {
        	  event.preventDefault();
        	  
              showResult("std");
          });
          
          $("#resetbutton").on( "click", function( event ) {
        	  $("#form_searchform").reset();
          });
          
          $("#linkplzsort").on( "click", function( event ) {
        	  event.preventDefault();
        	  
              showResult("plz");
          });
          
          $("#userCookie").on( "click", function( event ) {
  		  });
          
          $("#linkstandardsort").on( "click", function( event ) {
        	  event.preventDefault();
        	 
              showResult("std");
          });
          
          $("#searchprofilesubmit").on("click", function() {
        	 
        	  if(!validateEmail($('#searchprofileemail').val()))
        		  $("#searchprofileerrormsg").show();
        	  else
        	  	registerSearchProfile();
        	  
        	  return false;
        	  
          });
          
          $("a[id*=showfavorites]").on( "click", function( event ) {
        	  event.preventDefault();
        	  
        	  $.getJSON(dkmRestAPIURL+"/jobs/favorites/list/"+userCookie+"___"+$.now(), function(data){
      	  		$htmlstring = "<ul data-role='listview'>";
      	  	    $panelstring = "";
      	  		
          		$.each(data, function (index, value) {
          			if(value["fav"] == "true") {
            			
              		    iconFav = "fav-active";
           				iconFavText = "gemerkt"
            		} else {
            			
              		    iconFav = "fav-inactive";
            			iconFavText = "merken"
            		}

             			
             			if(value["jobtype"] == "text") {
                   			$htmlstring += '<li><a href="#jobPopupfl'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
                   			$htmlstring += '<div data-role="popup" id="jobPopupfl'+value["id"]+'" data-scroll="x" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window">';
                   			$htmlstring += '</div>';
                   		} else if (value["jobtype"] == "bildpdf" || (value["jobtype"] == "url" && value["url"].indexOf(".pdf") >= 0)) {
                   			$htmlstring += '<li><a href="#jobPopupfl'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
                   			$htmlstring += '<div data-role="popup" id="jobPopupfl'+value["id"]+'" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window"><a href="#" id="favlinkfl'+value["id"]+'" data-role="button" data-theme="a" data-icon="'+iconFav+'" data-iconpos="left" data-mini="true" class="ui-btn-left">'+iconFavText+'</a><a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
                   			$htmlstring += '<p style="text-align: center;">';
                   			$htmlstring += '<a data-theme="a" data-inline="true" data-icon="arrow-d" data-role="button" id="pdflinkfl'+value["id"]+'" href="'+value["url"]+'">PDF-Download</a>';
                		    $htmlstring += '</p>';
                		    $htmlstring += '</div>';
                   		} else {
                   			$htmlstring += '<li><a href="#jobPopupfl'+value["id"]+'" data-rel="popup" data-transition="pop"><h3>'+value["name"]+'</h3><p>PLZ:'+value["plz"]+'</p><p>'+value["subline"]+'</p></a></li>';
                   			$htmlstring += '<div data-role="popup" id="jobPopupfl'+value["id"]+'" data-overlay-theme="a" data-theme="a" class="ui-content" data-position-to="window"><a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>';
                   			$htmlstring += '</div>';
                   		}
             			
          		});
          		
          		$('#searchfavoriteslist').html($htmlstring+"</ul>").trigger("create");
          		
          		$("a[id*=pdflink]").on( "click", function( event ) {
                	  event.preventDefault();
                	  var targetlink = $(this).attr("href");
                	  var ref = window.open(targetlink,"_system","location=yes");
                });
            		
          		$.each(data, function (index, value) {
         			
         			
         			if(value["jobtype"] == "text") {
         				$( "#jobPopupfl"+value["id"] ).on({
         			        popupbeforeposition: function() {
         			          setIFrame(value["id"],"http://media.dkm-service.de/stellenmarkt/index.php?module=showjob&ID="+value["id"]+"&location=mobile","fl","true");
         			        },
         			        popupafterclose: function() {}
         			    });
         				
               		} else if (value["jobtype"] == "url" && value["url"].indexOf(".pdf") < 0) {
               			$( "#jobPopupfl"+value["id"] ).on({
         			        popupbeforeposition: function() {
         			        	setIFrame(value["id"],value["url"],"fl","true");
         			        },
         			        popupafterclose: function() {}
         			    });
               		} else if (value["jobtype"] == "bildpdf" || (value["jobtype"] == "url" && value["url"].indexOf(".pdf") >= 0)) {
         			  $("#favlinkfl"+value["id"]).on("click", function(event) {
              			 if($(this).attr("data-icon") == "fav-active") {
              				 $.get(dkmRestAPIURL+"/jobs/favorite/delete/"+userCookie+"__"+value["id"], function(data){  
              				 	
           					 });
              				 
          					 $(this).attr("data-icon","fav-inactive");
              				 $(this).find('.ui-icon').removeClass('ui-icon-fav-active').addClass('ui-icon-fav-inactive');
              				 $(this).find('.ui-btn-text').text("merken");
              	 		 } else {
              	 			$.get(dkmRestAPIURL+"/jobs/favorite/add/"+userCookie+"__"+value["id"], function(data){  
              	 			}); 
              	 			
          					$(this).attr("data-icon","fav-active");
              				$(this).find('.ui-icon').removeClass('ui-icon-fav-inactive').addClass('ui-icon-fav-active');
              				$(this).find('.ui-btn-text').text("gemerkt");
              	 		 }
              		  });
               		}
         			
      		    });
          		
        	  });
      		
              $.mobile.changePage($('#searchfavorites'),{ transition: "slideup"});
          });
          
          function sendFavorites() {
        	  var email = $("#sendfavoritesemail").val();
        	  $.get(dkmRestAPIURL+"/jobs/favorites/send/"+userCookie+"__"+email, function(data){  
        	  	if(data == "OK") {
        	  		$("#popupSendFavoritesDialog").hide();
              	    $("#popupSendFavoritesSubmit").show();
        	  	} else {
        	  		$("#sendfavoriteserrormsg").text(data);
        	  		$("#sendfavoriteserrormsg").show();
        	  	}
        	  });  
          }
          
          function deleteFavorites() {
        	  $.get(dkmRestAPIURL+"/jobs/favorites/delete/"+userCookie, function(data){  
        	  	if(data == "OK") {
        	  		$("#popupFavoritesDialogDelete").hide();
              	    $("#popupFavoritesSubmitDelete").show();
        	  	}
        	  });  
          }
          
          $("#distance").on("change", function() {
            var n = ""+$('#plz').val();
         	  if($(this).val() > 0 && n.length != 5) {
              $("#locationError").show();
              $("#distance").val("0").selectmenu("refresh");
            } else {
              $("#locationError").hide();
            }
          });
          
          $("#plz").on("blur", function() {
            var n = ""+$(this).val();
         	  if($('#distance').val() > 0 && n.length != 5) {
              $("#locationError").show();
              $("#distance").val("0").selectmenu("refresh");
            } else {
              $("#locationError").hide();
            }
          });
          
          
          $("#sendfavoritessubmit").on("click", function() {
         	 
        	  if(!validateEmail($('#sendfavoritesemail').val()))
        		  $("#sendfavoriteserrormsg").show();
        	  else
        	  	sendFavorites();
        	  
        	  return false;
        	  
          });
          
          $("#favoritessubmitdelete").on("click", function() {
         	 
        	  deleteFavorites();
        	  
        	  return false;
        	  
          });
          
                  
  
       });
       
       function onDeviceReady() {
         mobileUUID = device.uuid;
         userCookie = device.uuid;
         if(device.platform == "iOS") {
            StatusBar.overlaysWebView(false);
         }
       } 
      
       function onLoad() {
        document.addEventListener("deviceready", onDeviceReady , false);
       }
       
      
  </script>
  
  </head>

  <body onload="onLoad()">     
       <div data-role="page" id="searchform">
            <div data-role="header" data-position="fixed" data-theme="a" id="dkmheader">
              <h1>Stellenmarkt f&uuml;r Kirche und Caritas</h1><a href="index.html" data-ajax="false" data-icon="home" data-role="button" data-iconpos="notext" class="ui-btn-left" data-ajax="false"></a><a href="#popupNavi" data-transition="pop" data-rel="popup" data-icon="bars" data-role="button" data-iconpos="notext" class="ui-btn-right"></a>
              <!-- <div data-role="navbar" data-iconpos="left" data-theme="a">
                <ul>
                    <li><a href="index.html" data-icon="home" data-role="button" style="color: #ec008c; font-size: 16px; font-weight: bold;">Stellenmarkt f&uuml;r Kirche und Caritas</a></li>
                </ul>
              </div> -->
              <div data-role="popup" id="popupNavi" data-theme="a">
                 <ul data-role="listview" data-inset="true" style="min-width:210px;" data-theme="d">
                    <li><a href="suche.html" data-ajax="false">Stellensuche</a></li>
                    <li><a href="suchprofil.html" data-ajax="false">Such-Profil</a></li>
                    <li><a href="#" data-ajax="false" id="showfavorites">Merkliste</a></li>
                 </ul>
              </div>
              <!-- <div data-role="navbar" data-iconpos="left" data-theme="a">
                <ul>
                    <li><a href="suche.html" data-icon="search" data-role="button" data-transition="slideup">Stellensuche</a></li>
                    <li><a href="suchprofil.html" data-icon="edit" data-role="button" data-transition="slideup">Such-Profil</a></li>
                </ul>
              </div> -->            
            </div>
            <div data-role="content" data-theme="a">
               <h3>Stelle suchen</h3>
               <p>Bitte legen Sie hier fest, nach welchen Stellenangeboten Sie suchen wollen. Für Aktualität und Inhalt &uuml;bernehmen wir keine Verantwortung.<p>
               <form id="form_searchform">
               <div data-role="fieldcontain">
               <label for="select-branche" class="select">Branche</label>
               <select name="select-branche" id="select-branche" multiple="multiple" data-native-menu="false" data-icon="grid" data-iconpos="left">
               </select>                     
               </div>
               <div data-role="fieldcontain">
               <label for="select-berufsfeld" class="select">Berufsfeld</label>
               <select name="select-berufsfeld" id="select-berufsfeld" multiple="multiple" data-native-menu="false" data-icon="grid" data-iconpos="left">
               </select>                     
               </div>
               <div data-role="fieldcontain">
               <label for="select-stellentyp" class="select">Stellen-Typ</label>
               <select name="select-stellentyp" id="select-stellentyp" multiple="multiple" data-native-menu="false" data-icon="grid" data-iconpos="left">
               </select>
               </div>
               <div data-role="fieldcontain"><label for="plz">Postleitzahl (1-5-stellig)</label><input name="plz" pattern="[0-9]{1,5}" id="plz" value="" type="number" data-clear-btn="true"></div>
               <div data-role="fieldcontain"><label for="distance">Umkreissuche</label>
               <select name="distance" id="distance" data-native-menu="false" data-icon="grid" data-iconpos="left">
    <option value="0" selected="selected">---</option>
    <option value="30">30 km</option>
    <option value="50">50 km</option>
    <option value="100">100 km</option>
    <option value="200">200 km</option>
</select><span style="color: #EC008C;" id="locationError">Bei einer Umkreissuche bitte eine 5-stellige Postleitzahl angeben.</span></div>
               <div data-role="fieldcontain"><label for="ausland">Ausland</label>
               <select name="ausland" id="ausland" data-role="slider" data-mini="true">
    <option value="0" selected="selected">Nein</option>
    <option value="1">Ja</option>
</select></div>
<div data-role="fieldcontain"><label for="fulltextstring">In Stellen suchen nach</label><input name="fulltextstring" id="fulltextstring" value="" type="search"></div>
</form>
            </div>
            <div data-role="footer" data-position="fixed" id="dkmfooter" class="ui-bar">
            
          <a href="#" data-role="button" data-theme="a" data-icon="delete" id="resetbutton">Zur&uuml;cksetzen</a>
    			<a href="#" data-role="button" id="submitbutton" data-theme="a" data-icon="arrow-r">Suche starten</a>
            </div>
       </div>
       <div data-role="page" id="searchresult">
            <div data-role="header" data-position="fixed" data-theme="a" id="dkmheader">
              <h1>Stellenmarkt f&uuml;r Kirche und Caritas</h1><a href="index.html" data-ajax="false" data-icon="home" data-role="button" data-iconpos="notext" class="ui-btn-left" data-ajax="false"></a><a href="#popupNavi" data-transition="pop" data-rel="popup" data-icon="bars" data-role="button" data-iconpos="notext" class="ui-btn-right"></a>
              <div data-role="navbar" data-iconpos="left" data-theme="a">
                <ul>
                    <li><a href="#popupSort" data-rel="popup" data-role="button" data-inline="true" data-transition="slideup" data-icon="gear" data-theme="a">Sortieren nach ...</a></li>
                    <li><a href="#popupSearchProfile" data-transition="pop" data-rel="popup" data-inline="true" data-icon="grid" data-theme="a" id="linksearchprofile">In Suchprofil umwandeln</a></li>
                </ul>
              </div>
              <div data-role="popup" id="popupNavi" data-theme="a">
                 <ul data-role="listview" data-inset="true" data-theme="a">
                    <li><a href="suche.html" data-ajax="false">Stellensuche</a></li>
                    <li><a href="suchprofil.html" data-ajax="false">Such-Profil</a></li>
                    <li><a href="#" data-ajax="false" id="showfavoritessr">Merkliste</a></li>
                 </ul>
              </div>
              <div data-role="popup" id="popupSort" data-theme="a">
                 <ul data-role="listview" data-inset="true" data-iconpos="left" data-theme="a">
                    <li data-icon="arrow-d"><a href="#" id="linkplzsort">Postleitzahl</a></li>
                    <li data-icon="arrow-d"><a href="#" id="linkstandardsort">Aktualit&auml;t</a></li>
                 </ul>
              </div>
              <div class="ui-corner-all" data-role="popup" id="popupSearchProfile" style="max-width:400px;" data-theme="a" data-dismissible="false">
                  	<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
                  	<div id="popupSearchProfileDialog">
                  	<form id="form_searchprofilepopupform">
							<div style="padding:10px 20px;">
							  <h4>Bitte teilen Sie uns Ihre e-mail-Adresse mit. Sie werden benachrichtigt, falls eine neu eingetragene Stelle dem Profil Ihrer gerade getätigten Suchanfrage entspricht.</h4>
					          <label for="searchprofileemail" class="ui-hidden-accessible">E-Mail-Adresse:</label>
					          <input type="text" name="searchprofileemail" id="searchprofileemail" value="" placeholder="E-Mail-Adresse" data-theme="a" />
					    	  <span style="color: #EC008C;" id="searchprofileerrormsg">Bitte geben Sie eine gültige E-Mail-Adresse an.</span>
					    	  <button type="submit" data-theme="a" data-icon="check" id="searchprofilesubmit">Suchprofil abonnieren</button>
					    	  <p>Ihre Daten werden ausschliesslich zum Zwecke des Newsletterversands für den Stellenmarkt für Kirche und Caritas gespeichert 
                  und nicht an Dritte weitergegeben. Der Newsletterbezug kann jederzeit mittels des Ihnen per E-Mail zugeleiteten 
                  Passwortes gekündigt werden. Ihre Benutzerdaten werden dann umgehend gelöscht. 
                  Eine automatische Löschung Ihrer Daten erfolgt spätestens sechs Wochen nach Eintrag Ihres Suchprofils.</p>
							</div>
					
					</form>
					</div>
					<div id="popupSearchProfileSubmit">
							<div style="padding:10px 20px;">
								<h3>Das Suchprofil wurde erfolgreich registriert.</h3>
							</div>
					</div>
			   </div>
            </div>
            <div data-role="content" id="contentpagesearchresult">
            	<div id="searchresultlist">
            		<ul data-role="listview">
					</ul>
			  	</div>
            </div>
            <div data-role="footer" data-position="fixed" id="dkmfootersr">
               <div data-role="popup" id="popupInfo" data-theme="a">
                  <p>Ein Service der:</p>
                  <p><strong>DKM Darlehnskasse Münster eG</strong><br/>
                             Breul 26<br/>
                             48143 M&uuml;nster<br/>
                             Tel.: 0251 / 51013 - 200<br/>
                             Fax: 0251 / 51013 - 115<br/>
                             E-Mail: info@dkm.de<br/>
                             Internet: https://www.dkm.de</p>
               </div>
               <h1>&copy; 2017 Darlehnskasse M&uuml;nster eG</h1><a href="#popupInfo" data-transition="pop" data-rel="popup" data-icon="info" data-iconpos="notext" class="ui-btn-right"></a>
            </div>
            
       </div>

       <div data-role="page" id="searchfavorites">
            <div data-role="header" data-position="fixed" data-theme="a" id="dkmheader">
              <h1>Stellenmarkt f&uuml;r Kirche und Caritas</h1><a href="index.html" data-ajax="false" data-icon="home" data-role="button" data-iconpos="notext" class="ui-btn-left"></a><a href="#popupNavi" data-transition="pop" data-rel="popup" data-icon="bars" data-role="button" data-iconpos="notext" class="ui-btn-right"></a>
              <div data-role="navbar" data-iconpos="left" data-theme="a">
                <ul>
                    <li><a href="#popupSendFavorites" id="sendallfavorites"  data-transition="pop" data-rel="popup" data-inline="true" data-role="button" data-icon="arrow-r" data-theme="a">Per E-Mail versenden</a></li>
                    <li><a href="#popupFavoritesDelete" id="deleteallfavorites" data-transition="pop" data-rel="popup" data-inline="true" data-role="button" data-icon="bars" data-theme="a">Merkliste löschen</a></li>
                </ul>
              </div>
              <div data-role="popup" id="popupNavi" data-theme="a">
                 <ul data-role="listview" data-inset="true" data-theme="a">
                    <li><a href="suche.html" data-ajax="false">Stellensuche</a></li>
                    <li><a href="suchprofil.html" data-ajax="false">Such-Profil</a></li>
                    <li><a href="#" data-ajax="false" id="showfavoritessf">Merkliste</a></li>
                 </ul>
              </div>
            </div>
            <div data-role="content" id="contentpagesearchfavorites">
            	<div id="searchfavoriteslist">
            		<ul data-role="listview">
					</ul>
			  	</div>
			  	<div class="ui-corner-all" data-role="popup" id="popupSendFavorites" style="max-width:400px;" data-theme="a" data-dismissible="false">
                  	<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
                  	<div id="popupSendFavoritesDialog">
                  	<form id="form_sendfavoritespopupform">
							<div style="padding:10px 20px;">
							  <h4>Bitte geben Sie die E-Mail-Adresse an, an welche Sie Ihre Merkliste senden möchten.</h4>
					          <label for="sendfavoritesemail" class="ui-hidden-accessible">E-Mail-Adresse:</label>
					          <input type="text" name="sendfavoritesemail" id="sendfavoritesemail" value="" placeholder="E-Mail-Adresse" data-theme="a" />
					    	  <span style="color: #EC008C;" id="sendfavoriteserrormsg">Bitte geben Sie eine gültige E-Mail-Adresse an.</span>
					    	  <fieldset class="ui-grid-a">
    <div class="ui-block-a"><a href="#" id="resetbutton" data-role="button" data-rel="back" data-theme="a" data-icon="delete" data-iconpos="left">Abbrechen</a></div>
    <div class="ui-block-b"><button type="submit" data-theme="a" data-icon="check" id="sendfavoritessubmit">Senden</button></div>
					    	</fieldset>  
							</div>
					
					</form>
					</div>
					<div id="popupSendFavoritesSubmit">
							<div style="padding:10px 20px;">
								<h3>Ihre Merkliste wurde erfolgreich versendet.</h3>
							</div>
					</div>
				
			   </div>
			   
			   <div class="ui-corner-all" data-role="popup" id="popupFavoritesDelete" style="max-width:400px;" data-theme="a" data-dismissible="false">
                  	<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
                  	<div id="popupFavoritesDialogDelete">
                  	<form id="form_favoritespopupformdelete">
							<div style="padding:10px 20px;">
							  <h4>Möchten Sie wirklich Ihre Merkliste löschen?</h4>
					    	  <fieldset class="ui-grid-a">
    <div class="ui-block-a"><a href="#" id="resetbutton" data-role="button" data-rel="back" data-theme="a" data-icon="delete" data-iconpos="left">Abbrechen</a></div>
    <div class="ui-block-b"><button type="submit" data-theme="a" data-icon="check" id="favoritessubmitdelete">Löschen</button></div>
					    	</fieldset>  
							</div>
					</form>
					</div>
					<div id="popupFavoritesSubmitDelete">
							<div style="padding:10px 20px;">
								<h3>Die Merkliste wurde erfolgreich gelöscht.</h3>
							</div>
					</div>
               </div>
               
            </div>
            <div data-role="footer" data-position="fixed" id="dkmfootersr">
               <div data-role="popup" id="popupInfo" data-theme="a">
                  <p>Ein Service der:</p>
                  <p><strong>DKM Darlehnskasse Münster eG</strong><br/>
                             Breul 26<br/>
                             48143 M&uuml;nster<br/>
                             Tel.: 0251 / 51013 - 200<br/>
                             Fax: 0251 / 51013 - 115<br/>
                             E-Mail: info@dkm.de<br/>
                             Internet: https://www.dkm.de</p>
               </div>
               <h1>&copy; 2017 Darlehnskasse M&uuml;nster eG</h1><a href="#popupInfo" data-transition="pop" data-rel="popup" data-icon="info" data-iconpos="notext" class="ui-btn-right"></a>
            </div>
       </div>
  </body>
</html>
